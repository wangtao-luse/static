define("api",function(){function e(e,t){var r=e;return $.each(t,function(e,t){r=r.replace("{{"+e+"}}",t)}),r}var t="source=pc",r={cate:{normal:"rankcate?rankId=rank3001&"+t,defensor:"//storage.jd.com/6b3ffdbd1c/667778157d.js"},cate_all:{normal:"allcate?"+t,defensor:"//storage.jd.com/6b3ffdbd1c/ffb8c23586.js"},sale:{normal:"hotsale2?cateid={{cateId}}&"+t,defensor:"//storage.jd.com/5ff97f85973eb87c/ef08ab060b.js"},shop:{normal:"shop2?cateid={{cateId}}&"+t,defensor:"//storage.jd.com/5ff97f85973eb87c/ad4271567f.js"},preferred:{normal:"prop-list-new?cateid={{cateId}}&"+t,defensor:""},search:{normal:"hotwords?cateid={{cateId}}&"+t,defensor:""},searchlist:{normal:"wordssearch?words={{words}}&"+t,defensor:"//storage.jd.com/5ff97f85973eb87c/43a3cb1128.js"},discount:{normal:"save?cateid={{cateId}}&"+t,defensor:"//storage.jd.com/5ff97f85973eb87c/9933997e9c.js"},preferred_detail:{normal:"index_new.php?app=Discovergoods&action=getDisAlbumDetail&modelType=content&id={{id}}",defensor:""}},a={cate:{normal:"",cms:"http://portal.cms.jd.com/preview/preview/preview/3725",dev:"index.html"},sale:{normal:"sale",cms:"http://portal.cms.jd.com/preview/preview/preview/3745",dev:"sale.html"},preferred:{normal:"preferred",cms:"http://portal.cms.jd.com/preview/preview/preview/3735",dev:"preferred.html"},shop:{normal:"shop",cms:"http://portal.cms.jd.com/preview/preview/preview/3743",dev:"shop.html"},search:{normal:"search",cms:"http://portal.cms.jd.com/preview/preview/preview/3746",dev:"search.html"},discount:{normal:"discount",cms:"http://portal.cms.jd.com/preview/preview/preview/3744",dev:"discount.html"},cate_all:{normal:"",cms:"http://portal.cms.jd.com/preview/preview/preview/3725",dev:"index.html"},preferred_detail:{normal:"preferred_detail",cms:"http://portal.cms.jd.com/preview/preview/preview/3734",dev:"preferred_detail.html"}};return{API:r,renderUrl:e,Pages:a}}),define("updateTime",function(){return{sale:10,shop:60,hotsearch:1440,discount:60}}),define("setFloorData",function(){return function(e,t,r){t?window.data[e][t]=r:window.data[e]=r}}),define("topStore",["store","checkUpdate","updateTime"],function(require,exports,module){var e=require("store"),t=require("checkUpdate"),r={},a="top-timestamp",o=e.get(a),n=require("updateTime");return r.setStore=function(t,r,a){if("top_preferred"!==r){var o=e.get(r,0)||{},n=a.resCid,i=a.reqCid;e.get(n,0)||{};n&&(o[n]=n),i&&(o[i]=n),e.set(r,o),e.set(r+":"+n,a)}},r.checkStore=function(r,a,o){var i=e.get(a,0),s=i?e.get(a+":"+i[r],0):0;if(s){var c=o?t(s.ctime,n[a.replace("top_","")]):1;if(c)return s}return!1},r.getStore=function(t,r){var a=e.get(r,0);if(a&&a[t]){var o=e.get(a[t],0);if(o&&o[r])return o[r];if($.each(a,function(e,t){if(o=t[r])return!1}),o)return o}return!1},r.removeStore=function(t,r){e.remove(r+":"+t)},r.removeAllStore=function(){e.clearByReg("^top_")},(!o||o&&!t(o))&&(r.removeAllStore(),e.set(a,Date.parse(new Date))),r}),define("uri",function(){"use strict";function e(t){for(var r=e.options,a=r.parser[r.strictMode?"strict":"loose"].exec(t),o={},n=14;n--;)o[r.key[n]]=a[n]||"";return o[r.q.name]={},o[r.key[12]].replace(r.q.parser,function(e,t,a){t&&(o[r.q.name][t]=a)}),o}e.options={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}};var t=function(t){this.url=t,this.data=e(t)};return t.prototype={getQueryParamValue:function(e){return this.data.queryKey[e]},getQueryParamObj:function(){return this.data.queryKey},modifyAnchor:function(e){this.data.anchor=e.toString()},modifyQueryParam:function(e,t){this.data.queryKey[e]=t.toString()},getKeyValue:function(e){return this.data[e]},toString:function(){var e=this.data.protocol+"://"+this.data.authority+this.data.path;if(this.data.queryKey){e+="?";for(var t in this.data.queryKey)e+=t+"="+this.data.queryKey[t]+"&"}return e=e.replace(/&$/,""),e+="#"+this.data.anchor}},t}),define("event",function(){var e=function(e){this._sender=e,this._listeners=[]};return e.prototype={attach:function(e){this._listeners.push(e)},notify:function(e){for(var t=[],r=0;r<this._listeners.length;r++)t.push(this._listeners[r](this._sender,e));return t}},e}),define("bindEvent",function(){var e=function(e){$.each(e,function(e,t){"top_mod_cate"!=t&&$("#"+t).removeClass("o2loading").removeClass("o2data-lazyload").addClass("o2data-lazyload"),$("#"+t).unbind("beforerender").unbind("done"),$("#"+t).bind("beforerender",function(e,r){_.eventCenter.trigger(t+":beforerender",r)}),$("#"+t).bind("done",function(e){_.eventCenter.trigger(t+":done")})})};return e}),define("getUriPrefix",function(){return function(e){var t=e.uri,r=e.page,a=e.cms,o=e.dev,n=e.exclude||["cateId","cateid"],i={},s=t.data.authority.match("top.jd.com")?t.data.protocol+"://"+t.data.authority+"/"+r:t.data.authority.match("portal.cms")?a:t.data.protocol+"://"+t.data.authority+t.data.directory+o,c=[];return s+="?",$.each(n,function(e,t){i[t]=!0}),$.each(t.data.queryKey,function(e,t){i[e]||c.push(e+"="+t)}),c.length>0&&c.push(""),s+c.join("&")}}),define("handleData",function(){var e={setImgUrl:function(e,t,r){if(r=pageConfig.isRetina?2*r:r,e)return pageConfig.FN_GetImageDomain(e)+"n1/s"+r+"x"+r+"_"+t},setMobileImgUrl:function(e,t,r,a){if(t){r=pageConfig.isRetina?2*r:r,a=a?pageConfig.isRetina?2*a:a:r;var o=/(https?:\/\/)?(.*.360buyimg.com\/)?(\w*\/)(s?\d*x?\d*_?\w*\/)(.*)/,n=o.exec(t),i=n[4].replace(/s\d*x\d*_/,""),s=n[5],c=s.search(/(!q\d*).jpg/);return c>0&&(s=s.substring(0,c)),e&&s.search(/.gif/)==-1?pageConfig.FN_GetImageDomain(e)+n[3]+"s"+r+"x"+a+"_"+i+s+"!cc_"+r+"x"+a:n[1]?t:"//m.360buyimg.com/"+t}}};return e}),define("getFree",["load_async"],function(){var e=function(e,t,r){var a=t.length,o=seajs.require("load_async"),n=[];if(a>0){for(var i=0;i<a;i++){var s=t[i];$(s).data("sku")&&n.push(s)}for(var c=n.length,d=[],u=[],i=0;i<c;i+=100)d.push(e.slice(i,i+100)),u.push(n.slice(i,i+100));$.each(u,function(e,t){o({url:"//ch.jd.com/getShowMarks?params="+JSON.stringify(d[e]),times:2}).done(function(e){for(var a=0;a<t.length;a++)for(var o=t[a],n=0;n<e.length;n++){var i=e[n];$(o).data("sku")==i.skuId&&3==i.freeMark&&($(o).find(".top_mod_tag_by").css("display","inline-block"),$(o).find(".top_mod_tag_afterby").css("display","none"))}r.show()}).fail(function(e){r.show()})})}else r.show()};return e}),define("triggerLazyLoad",function(){var e=function(e){for(var t=0;t<e.length;t++){var r=e.eq(t).find("img");if(r.length>0)for(var a=0;a<r.length;a++){var o=r.eq(a).attr("data-lazy-src");r.eq(a).attr("data-lazy-img",o),r.eq(a).removeAttr("data-lazy-src")}}$(window).trigger("resize.o2-lazyload")};return e}),define("countDown",["//misc.360buyimg.com/mtd/pc/components/countdown/1.0.0/countdown.js","//misc.360buyimg.com/mtd/pc/components/util/1.0.0/util.js","checkUpdate"],function(){var e=function(e,t,r){var a,o,n=seajs.require("//misc.360buyimg.com/mtd/pc/components/countdown/1.0.0/countdown.js"),i=seajs.require("//misc.360buyimg.com/mtd/pc/components/util/1.0.0/util.js"),s=seajs.require("checkUpdate"),c=new Date,d=i.getCalendar(c,0),u=i.getCalendar(c,1),f=e.find(".top_mod_dimension"),l=c.getHours(),m=c.getMinutes(),p=s(r,t);t<1440?(t<60?p?m+t>=60?(m=0,l+=1):m=10*Math.floor(m/10)+t:m=10*Math.floor(m/10):(l=p?l+1:l,m=0),24==l?(l=0,o=u):o=d):(o=0==l?d:u,l=0,m=0),a=o+" "+l+":"+m+":00";var h=f.find(".tmdi_cdhour"),v=f.find(".tmdi_cdmin"),g=f.find(".tmdi_cdtxt");new n({startTime:c,endTime:a,stateCallback:function(e){switch(e.state){case 0:g.html("请刷新页面更新榜单");break;case 1:f.hide();break;case 2:h.html(e.hour),v.html(e.minute)}}})};return e}),define("checkUpdate",["//misc.360buyimg.com/mtd/pc/components/util/1.0.0/util.js"],function(){var e=function(e,t){var r,a=seajs.require("//misc.360buyimg.com/mtd/pc/components/util/1.0.0/util.js"),o=new Date,t=t||10,n=new Date(e);return r=1440==t?new Date(a.getCalendar(n,0)).getTime()+60*t*1e3:n.getTime()+60*t*1e3,new Date(o).getTime()<=r};return e}),define("setError",function(){var e="Top_error";return{sett:function(t){$("#"+t).removeClass("o2data-lazyload").removeClass("o2loading").addClass(e).bind("click",function(){location.reload()})},remove:function(t){$("#"+t).removeClass(e).unbind("click")}}}),define("getStock",function(){var e=function(e,t){for(var r=seajs.require("load_async"),a=e.length,o=[],n=0;n<a;n++){var i=e[n];$(i).data("sku")&&o.push($(i).data("sku"))}for(var s=o.length,c=[],n=0;n<s;n+=100)c.push(o.slice(n,n+100));for(var d=0;d<c.length;d++)r({url:"//ch.jd.com/stock?skulist="+c[d].toString()+"&source=pc",times:2}).done(function(r){if("0"==r.code)for(var a=r.results,o=0,n=a.length;o<n;o++){var i=a[o],s=e.filter("[data-sku="+i.sku+"]");"1"==i.status&&!i.instock&&s.addClass("J_soldout"),"5"==i.status&&(s.addClass("J_overseas"),window.data.locate&&s.find(".top_overseas_locate").html(window.data.locate)),"function"==typeof t&&t(i.stocknum,i.sku)}}).fail(function(e){})};return e}),define("setFloorColor",function(){var e="top_floor_wrap",t=e+"_white",r=$("."+e);return function(e){var a="",o="";e?o=t:a=t,r.each(function(e,r){$(r).removeClass(t),e%2===0?$(r).addClass(o):$(r).addClass(a)})}});define("o2widgetLazyload",function(require,exports,module){"use strict";return function(e){var t={cls:"o2data-lazyload",defCls:["lazy-fn","o2loading"],scrollEvent:"scroll.lazydata resize.lazydata"},o=window.pageConfig?window.pageConfig.o2JSConfig:{};o=o||{},window._o2ver={},$.extend(t,e),window.tplVersion=$.extend(window.o2tplVersion||{},window.tplVersion);var n=require("store"),a=!!window.ActiveXObject||navigator.userAgent.indexOf("Trident")>0,i="localStorage"in window&&null!==window.localStorage,r=a?1e3:500,l=t.defCls.concat(t.cls).join(" ");r=o.preloadOffset?o.preloadOffset:r;var d=!!o.ieStorage&&o.ieStorage,s=d&&i,c=function(){var e=null;_.eventCenter.trigger("channel:ready"),$(window).bind(t.scrollEvent,function(t){clearTimeout(e),e=setTimeout(function(){f()},200)}).trigger(t.scrollEvent.split(" ")[0])},f=function(){var e=$(document).scrollTop(),i=$(window).height()+r,l=t.cls,d=$("."+l);d.each(function(){var t=$(this),r=t.data("rel")||this,l=$(r),d=t.html(),c=t.data("tpl")||"",f=t.data("remotetpl")||"",p="boolean"==typeof t.data("async")&&t.data("async"),v="boolean"==typeof t.data("forcerender")&&t.data("forcerender"),y=null;if(""!==f&&(c=f),!t.hasClass("o2loading")&&(v||l.offset().top-(e+i)<0&&l.offset().top+l.outerHeight(!0)>=e))if(""!==c&&o.pathRule)if(/\.js/.test(c)?(y=c,c=y.match(/\/(\w*)(\.min)?\.js/)[1]||""):y=o.pathRule(c),!s&&a||!n.enabled)w(t,d,p,"",u(y,!1,t));else{var m=n.get(y);m&&window.tplVersion&&m.version===window.tplVersion[c]?(g(t,m),w(t,d,p,m)):w(t,d,p,"",u(y,!0,t))}else w(t,d,p,"")})},g=function(e,t){"object"==typeof t&&(window._o2ver[t.version]||(t.style&&$("head").append("<style>"+t.style+"</style>"),t.script&&$("head").append("<script>"+t.script+"</script>"),window._o2ver[t.version]=t.version,e.trigger("tplLoadDone",t),setTimeout(function(){f()},200)))},u=function(e,t,o){var a=$.Deferred();return seajs.use(e,function(i){i?(t&&n.set(e,i),g(o,i),a.resolve(i)):a.reject()}),a.promise()},p=function(e,t,o,n){"undefined"!=typeof n?$.when(n).done(function(o){e.html(t).removeClass(l).trigger("render",o)}).fail(function(){e.trigger("tplLoadFail")}):e.html(t).removeClass(l).trigger("render",o)},w=function(e,t,o,n,a){o?e.data("events")&&e.data("events").beforerender&&e.html(t).addClass("o2loading").trigger("beforerender",function(){p(e,t,n,a)}):e.addClass("o2loading")&&p(e,t,n,a)};c(),this.detectRender=f}}),define("channel",function(require){"use strict";var e=pageConfig.o2AppName||"";""!==e&&$("html").addClass(e);var t=require("o2console");t.consoleConfigFunc(),require.async(["jdf/1.0.0/unit/globalInit/5.0.0/globalInit.js","jdf/1.0.0/unit/category/2.0.0/category.js","//static.360buyimg.com/mtd/pc/components/1.0.0/lazyload/lazyload.js"],function(e,t,o){e(),t({type:"mini",mainId:"#categorys-mini",el:"#categorys-mini-main"});var n={};$("body").o2lazyload().bind("render",".o2data-lazyload",function(e,t){var o="",a=$(e.target),i=a.data("id"),r=a.data("script")||"",l=window.data[i]||{};if(n[i])o=n[i];else{var d=a.find('[type="text/template"]');o="object"==typeof t?t.dom:d.html(),n[i]=o}var s=require("o2tpl");try{var c=s(o,l);a.html(c),setTimeout(function(){a.trigger("done"),""!==r&&new Function(r).call(a),$(window).trigger("resize")},0)}catch(e){console.log(e)}});var a=require("o2widgetLazyload");window.o2widgetLazyload=new a})}),seajs.use("channel");define("backup",function(require,exports,module){"use strict";var t={a0:"//ai.jd.com/",a1:"//ch.jd.com/",a2:"//www.3.cn/bup/",backupPointId:{pageId:683,backupPageId:684,top_mod_cate:37,top_mod_cate_all:38,top_landing_sale:31,top_sale:41,top_landing_shop:32,top_shop:42,top_landing_search:33,top_landing_searchlist:40,top_hotsearch:43,top_searchlist:40,top_landing_discount:34,top_discount:44,top_landing_preferred_list:35,top_preferred:45,top_landing_preferred_detail:36,top_preferred_detail:47,top_landing_preferred_detail_footer:46,locate:39}};return t});define("widget/top_mod_tags",function(require,exports,module){"use strict";var t=function(){this.init()};return t.prototype={init:function(){var t=$(".J_tag");t.each(function(t,e){var o,i=$(e).find(".top_mod_tag_more"),n=i.find(".top_mod_tag_more_arrow"),a=i.find(".top_mod_tag_more_text");$(e).find(".top_mod_tag_item[data-info]").each(function(t,e){$(this).mouseenter(function(){clearTimeout(o);var t=$(this).position().left,e=$(this).width();a.text($(this).data("info")),n.css("left",t+e/2+1),i.fadeIn("fast")}).mouseleave(function(){o=setTimeout(function(){i.fadeOut("fast")},500)})}),i.mouseenter(function(){clearTimeout(o),i.fadeIn("fast")}).mouseleave(function(){o=setTimeout(function(){i.fadeOut("fast")},500)})})}},t});define("widget/top_mod_loadmore",["triggerLazyLoad"],function(require,exports,module){"use strict";var o=require("triggerLazyLoad"),t=function(o){$.extend(this,o),this.init()};return t.prototype={$dom:null,initNum:0,loadBtn:".top_mod_loadmore_btn",loadWrap:".top_mod_loadmore",loadBtnUnfold:"top_mod_loadmore_unfold",floor:0,loadCls:"o2data-lazyload",needUndo:!1,unfold:!1,unfoldInit:!0,bindUI:function(){var o=this;this.$loadBtn.bind("click",function(t){o.unfold=!o.unfold,o.dealList(o.unfold,o.unfoldInit),o.unfoldInit&&(o.unfoldInit=!1),o.needUndo?(o.unfold&&$(this).parent(o.loadWrap).addClass(o.loadBtnUnfold),!o.unfold&&$(this).parent(o.loadWrap).removeClass(o.loadBtnUnfold)):$(this).parent(o.loadWrap).css({display:"none"})})},init:function(){this.$loadBtn=$(this.loadBtn),this.$dom&&this.$dom.length>this.initNum?(this.dealList(this.unfold,!0),this.$loadBtn.parent(this.loadWrap).css({display:"block"}),this.bindUI()):this.$loadBtn.parent(this.loadWrap).css({display:"none"})},dealList:function(t,d){var n=this;t?(this.$dom.css({display:"block"}),d&&$.each(this.$dom,function(t,d){if(t>=n.initNum)if(n.floor)$(d).addClass(n.loadCls),$(window).trigger("scroll.lazydata");else{var a=$(d).find("img");a.length>0&&o($(d))}})):$.each(this.$dom,function(o,t){if(o<n.initNum)$(t).css({display:"block"});else if($(t).css({display:"none"}),n.floor)$(t).removeClass(n.loadCls);else{var a=$(t).find("img");d&&a.length>0&&$.each(a,function(o,t){var d=$(t).attr("data-lazy-img");$(t).attr("data-lazy-src",d),$(t).removeAttr("data-lazy-img")})}})}},t});define("widget/top_mod_key",function(require,t,module){"use strict";var e=function(t){this.node={hook:{keyWrap:".tmk",keyList:".tmk_list",cateAnchor:".tmc_anchor",keyAnchor:".tmk_anchor",title:".top_mod_cate_title"}},this.conf={floorId:"index_top_mod_cate",cateList:"",cateObj:{},curCate:"",curSubCate:"",curCls:"tmk_item_cur",keyListPrefix:"tmkList"},$.each(t,$.proxy(function(t,e){this.conf[t]=e},this)),this.init()};e.prototype={bindUI:function(){var t=this,e=t.node.hook,n=t.conf;_.eventCenter.on("top_mod_key:cateChange_"+n.floorId,function(e,o){if(o){var c=o;n.cateObj[e]=o}else var c=n.cateObj[e]?n.cateObj[e]:e;99999!=e?(t.setStyle(e,c),_.eventCenter.trigger("cateChange",e,c),t.setTitle(e,c)):t.setStyle(e)}),$(e.keyWrap).delegate(e.keyAnchor,"click",function(o){var c=$(o.currentTarget),a=c.closest(e.keyList),i=a.attr("data-cateid"),r=c.attr("data-cateid");return n.cateObj[i]=r,n.curCate=i,n.curSubCate=r,t.setStyle(),_.eventCenter.trigger("top_mod_cate:click",i),_.eventCenter.trigger("cateChange",i,r),!1})},setDom:function(){var t=this,e=t.node.hook,n=t.conf;$.each(e,function(t,o){e[t]="#"+n.floorId+" "+o}),n.keyListPrefix="#"+n.floorId+" #"+n.keyListPrefix,t.node.$floor=$("#"+n.floorId)},setStyle:function(t,e){var n,o=this.conf,c=this.node,a=c.hook,i=t?t:o.curCate,r=e?e:o.curSubCate;c.$keyList=$(a.keyList),$.each(c.$keyList,function(t,e){$(e).css({display:"none"})}),n=$(o.keyListPrefix+i),n.css({display:"block"}),$.each(n.children("li"),function(t,e){var n=$($(e).children(a.keyAnchor)).attr("data-cateid");n==r?$(e).addClass(o.curCls):$(e).removeClass(o.curCls)})},setTitle:function(t,e){var n=this.node.hook,o=(this.conf,$(n.title)),c=$(n.cateAnchor+"_"+t).attr("data-catename"),a=e==t?"":$(n.keyAnchor+"_"+e).attr("data-catename"),i=a?c+" — "+a:c;o.text("[ "+i+" ]")},init:function(){var t=this,e=t.conf;t.setDom(),t.bindUI(),_.eventCenter.trigger("top_mod_key:cateChange",e.curCate,e.curSubCate)}},_.eventCenter.on("top_mod_key:initKey",function(t,n){new e({curCate:t,curSubCate:n})})});define("widget/top_mod_cate",["uri","event","setFloorData","widget/top_mod_cate_all"],function(require,exports,module){"use strict";function t(t,e,a){var l=new s(t),c=new i(l,e,a),d=new n(l,c);return{M:l,V:c,C:d}}var e=require("event"),a=require("setFloorData"),s=function(t){this._dataList={},this._curType={bi:0,all:0},this.cateSwitch=new e(this),this.allCateSwitch=new e(this),this.dataGot=new e(this),this.cateInit=new e(this),this.switchToBi=new e(this)};s.prototype={changeData:function(t){var e=this.getCateName(t);t.cateName=e,_.eventCenter.trigger("top_floor_update",{cateInfo:t})},changeCate:function(t){var e=t.all?t.grade?t:this.getArgs(t)||this.getArgs(0):this.getArgs(t);e&&(this.setCurType(e.type),this.changeAllCate(e))},changeBiCate:function(t){var e=t.grade?t:this.getArgs(t);this.cateSwitch.notify(e)},changeAllCate:function(t){var e=t.grade?t:this.getArgs(t);"bi"===e.type?(this.changeBiCate(e),this.switchToBi.notify({cateInfo:{cateId:e.cateId,cateName:this.getCateName(e)}})):this.allCateSwitch.notify(e)},getArgs:function(t){if(t.cateId){var e=t.grade?t:this.checkCate(t);return e}return this.checkCate({cateId:this._dataList.cateList[0].cateId})},checkCate:function(t){var e=this._dataList.cateSearchList,a=t.cateId;if(!e[a])return!1;var s=e[a];return{cateId:a,type:s.type,grade:s.grade,parentId:s.parentId,grandId:e[s.parentId]?e[s.parentId].parentId:void 0}},setCateList:function(t){var e=this._dataList;e.cateList=t.cateList,this.dataGot.notify({data:t}),e.cateSearchList={},$.each(t.cateList,function(t,a){e.cateSearchList[a.cateId]={name:a.cateName,idx:t,type:"bi",grade:"second"},a.subCates&&$.each(a.subCates,function(t,s){e.cateSearchList[s.cateId]={name:s.cateName,idx:t,type:"bi",grade:"third",parentId:a.cateId}})})},setCateAllList:function(t){var e=this._dataList.cateSearchList;this._dataList.allCateList=t,$.each(t,function(t,a){e[a.cateId]={name:a.cateName,idx:t,type:"all",grade:"first"},a.subCates&&$.each(a.subCates,function(t,s){e[s.cateId]||(e[s.cateId]={name:s.cateName,idx:t,type:"all",grade:"second",parentId:a.cateId}),s.subCates&&$.each(s.subCates,function(t,a){return!!e[a.cateId]||void(e[a.cateId]={name:a.cateName,idx:t,type:"all",grade:"third",parentId:s.cateId})})})})},getDataList:function(){return this._dataList},getCateName:function(t){var e=this._dataList.cateSearchList,a="second"===t.grade?e[t.cateId].name:e[t.cateId]?e[t.parentId].name+" — "+e[t.cateId].name:"";return a},setCurType:function(t){this._curType[t]=1}};var i=function(t,s,i){this._model=t,this._elements=s,this._names=i,this._elements.$floor=$("#"+this._elements.floorId),this._prefix="#"+this._elements.floorId+" ",this.initArgs={},this.cateInited=new e(this),this.cateClicked=new e(this),this.allCateInited=new e(this),this.allCateClicked=new e(this),this.cateChanging=new e(this);var n=this,l=this._elements.floorId;this._model.dataGot.attach(function(t,e){a(l,"cateList",e.data.cateList)}),this._model.cateSwitch.attach(function(t,e){"third"===e.grade?n.setKeyStyle(e):n.setCateStyle(e.cateId),n.setFloorHeight()}),this._model.allCateSwitch.attach(function(t,e){n._model.changeData(e),n.setAllCateStyle(e),n.setFloorHeight()}),this._model.cateInit.attach(function(t,e){n.initArgs=e,n.cateInited.notify(e)}),this._model.switchToBi.attach(function(t,e){n.cateChanging.notify(e)}),_.eventCenter.on("cateMaskHide",function(){n.maskHide()})};i.prototype={initElements:function(){this.setElements(["items","keyLists","fixedwrap","more"])},initAllElements:function(t){var e=this._elements;this.setElements(["allList","allFstItems","allFstList","allScdItems","allScdList","allTrdItems","allScdWrap"]),this.bindAllUI(),this.setAllCateStyle({index:0}),!this._model._curType.bi&&this.allCateInited.notify(t);var a=window.document.documentElement.clientHeight-parseInt(e.$allList.css("top"))-parseInt(e.$allFstList[0].clientHeight)-10,s=window.document.documentElement.clientWidth;"maxHeight"in document.documentElement.style?a<parseInt(e.$allScdWrap.css("max-height"))&&e.$allScdWrap.css({maxHeight:a+"px"}):a<parseInt(e.$allScdWrap.css("height"))&&e.$allScdWrap.css({height:a+"px"}),s>=parseInt(e.$allList.css("width"))||($("#"+e.floorId).addClass(this._names.cateMini),e.$allList.css({width:s+"px"}).addClass(this._names.allMini))},setElements:function(t){var e=this._elements,a=this._prefix,s=t;$.each(s,function(t,s){e["$"+s]=$(a+e[s])})},bindUI:function(){var t,e=this,a=this._elements,s=this._names,i=a.$floor,n=$(window),l=a.$fixedwrap,c=i.offset().top,d=i.offset().left;i.delegate(a.items,"click",function(t){t.preventDefault();var a=$(this).data("cateid"),s=$(this).data("catename");e.cateChanging.notify({cateInfo:{cateId:a,cateName:s}}),e.cateClicked.notify({cateId:a})}).delegate(a.keys,"click",function(t){t.preventDefault();var s=$(this).data("cateid"),i=$(this).data("catename")?$(this).closest(a.keyLists).data("catename")+" — "+$(this).data("catename"):$(this).closest(a.keyLists).data("catename");e.cateChanging.notify({cateInfo:{cateId:s,cateName:i}}),e.cateClicked.notify({cateId:s})}).delegate(a.more,"mouseenter",function(){t&&clearTimeout(t),i.removeClass(s.hoverMore).addClass(s.hoverMore)}).delegate(a.allList,"mouseenter",function(){t&&clearTimeout(t)}).delegate(a.items,"mouseenter",function(){t&&clearTimeout(t),t=setTimeout(function(){i.removeClass(s.hoverMore)},100)}),i.bind("mouseleave",function(){t&&clearTimeout(t),t=setTimeout(function(){i.removeClass(s.hoverMore)},500)}),n.bind("scroll.fixed",function(){var t=n.scrollTop()-c,a=n.scrollLeft()-d;return t<=0?void e.fixedCate(0,self):(t>0&&e.fixedCate(1,self),void(a<0||t<0||($("html").hasClass("csstransitions")?l.css({transform:"translateX(-"+a+"px)",webkitTransform:"translateX(-"+a+"px)",mozTransform:"translateX(-"+a+"px)"}):l.css({left:"-"+a+"px"}))))})},bindAllUI:function(){var t=this,e=this._elements,a=(this._names,e.$floor);a.delegate(e.allFstItems,"click",function(e){var a=$(this).data("index");t.allCateClicked.notify({index:a})}).delegate(e.allScdItems,"click",function(e){e.preventDefault();var a=$(this).data("cateid");t.allCateClicked.notify({cateId:a})}).delegate(e.allTrdItems,"click",function(e){e.preventDefault();var a=$(this).data("cateid");t.allCateClicked.notify({cateId:a})})},setCateStyle:function(t){var e=this._elements,a=e.$items,s=e.$keyLists,i=(e.$more,this._names.cateBiCur),n=this._names.keyBiCur;a.parent("li").removeClass(i),s.css({display:"none"}),t<0||(t?(this.setAllCateStyle(),$(e.keyLists+"_"+t).css({display:"block"}).find("li").removeClass(n).eq(0).addClass(n),$(e.items+"_"+t).closest("li").addClass(i)):(s.eq(0).css({display:"block"}),a.eq(0).closest("li").addClass(i)))},setKeyStyle:function(t){var e=this._elements,a=$(e.keyLists+"_"+t.parentId);this.setCateStyle(t.parentId),a.children("li").removeClass(this._names.keyBiCur),$(e.keys+"_"+t.cateId).closest("li").addClass(this._names.keyBiCur)},setAllCateStyle:function(t){var e=this._elements,a=this._names,s=e.$allFstItems,i=e.$allScdItems,n=e.$allScdList,l=e.$allTrdItems,c=e.$floor;if(s&&t&&t.cateId){c.removeClass(a.hoverMore),!e.$more.hasClass(a.moreCur)&&e.$more.addClass(a.moreCur),this.setCateStyle(-1),s.parent("li").removeClass(a.allFstCur),n.css({display:"none"}),i&&i.parent("div").removeClass(a.allScdCur),l&&l.parent("li").removeClass(a.allTrdCur);var d;"third"===t.grade?(d=t.grandId,$(e.allTrdItems+"_"+t.cateId).parent("li").addClass(a.allTrdCur)):"second"===t.grade&&(d=t.parentId,$(e.allScdItems+"_"+t.cateId).parent("div").addClass(a.allScdCur)),$(e.allFstItems+"_"+d).parent("li").addClass(a.allFstCur),$(e.allScdList+"_"+d).css({display:"block"})}else s&&t&&t.index>=0?(s.parent("li").removeClass(a.allFstCur),n.css({display:"none"}),s.eq(t.index).parent("li").addClass(a.allFstCur),n.eq(t.index).css({display:"block"})):(c.removeClass(a.hoverMore),e.$more.removeClass(a.moreCur),i&&i.parent("div").removeClass(a.allScdCur),l&&l.parent("li").removeClass(a.allTrdCur))},fixedCate:function(t){var e=this._elements,a=e.$floor,s=e.$fixedwrap,i=this._names.fixed;t?a.removeClass(i).addClass(i):(a.removeClass(i),s.attr("style",""))},setFloorHeight:function(){var t=$("#"+this._elements.floorId),e=t.find("."+this._elements.floorId+"_main")[0].clientHeight;t.css({height:e+"px"})},maskOut:function(){var t=$("#"+this._elements.floorId),e=this._names.mask;!t.hasClass(e)&&t.addClass(e)},maskHide:function(){var t=$("#"+this._elements.floorId),e=this._names.mask;t.removeClass(e)}};var n=function(t,e){this._model=t,this._view=e;var a=this;this._view.cateInited.attach(function(t,e){a.dataInit(e)}),this._view.cateClicked.attach(function(t,e){a.dataSwitch(e)}),this._view.allCateInited.attach(function(t,e){e.cateId?a.allCateInit(e):a._view.setAllCateStyle(e)}),this._view.allCateClicked.attach(function(t,e){e.cateId?a.allCateDataSwitch(e):a._view.setAllCateStyle(e)}),this._view.cateChanging.attach(function(t,e){_.eventCenter.trigger("top_floor_update",e)})};return n.prototype={dataSwitch:function(t){this._view.maskOut(),this._model.changeBiCate(t)},dataInit:function(t){this._model.changeCate(t)},allCateInit:function(t){t.all=1,this._model.changeCate(t)},allCateDataSwitch:function(t){this._model.changeAllCate(t)}},t}),define("allCateList",["load_async","api","backup","o2tpl"],function(require,exports,module){function t(t){var e=t.cateList,a={},s=[];return $.each(e,function(t,e){a[e.fid]=a[e.fid]||{},a[e.fid].catename=a[e.fid].catename||e.fname,a[e.fid].subCates?a[e.fid].subCates.push(e):a[e.fid].subCates=[e]}),$.each(a,function(t,e){s.push({cateId:t,cateName:e.catename,subCates:e.subCates})}),s}var e=t(list);return e});var tmd={isShow:!1,$tmdt:$("#J_tmdt"),$tmdw:$("#J_tmdw"),tmdtClick:function(){var t=this;t.$tmdt.click(function(){t.isShow?t.tmdwHide():t.tmdwShow()})},tmdwShow:function(){this.$tmdt.addClass("tmdt_unfold"),this.$tmdw.fadeIn("fast"),this.bindEvent(),this.isShow=!0},tmdwHide:function(){this.$tmdt.removeClass("tmdt_unfold"),this.$tmdw.fadeOut("fast"),this.unbindEvent(),this.isShow=!1},bindEvent:function(){var t=this,d=this.$tmdw.offset().top;$(document).bind("click.tmd",function(d){0===$(d.target).closest(t.$tmdt).length&&0===$(d.target).closest(t.$tmdw).length&&t.tmdwHide()}),$(window).bind("scroll.tmd",function(){var i=$(window).scrollTop();i>d?t.tmdwHide():""})},unbindEvent:function(){$(document).unbind("click.tmd"),$(window).unbind("scroll.tmd")},init:function(){this.tmdtClick()}};tmd.init();define("index3.0/widget/top_mod_maintitle",function(require,exports,module){"use strict"});define("countdown",function(require,exports,module){var t=function(t){this.conf={floorId:"",start:0,gap:0,itvid:0},$.each(t,$.proxy(function(t,e){this.conf[t]=e},this)),this.init()};t.prototype={init:function(){var t=this.conf;t.gap>0&&(t.itvid=window.setInterval(function(){t.gap-=1,t.gap<=0?(window.clearInterval(t.itvid),_.eventCenter.trigger("showRefresh:"+t.floorId,1)):_.eventCenter.trigger("ticktock:"+t.floorId,t.gap)},6e4))}},_.eventCenter.on("startCountDown",function(e,n){var i=(new Date).getTime();new t({floorId:e,start:i,gap:n})})}),define("widget/top_mod_dimension",function(require,exports,module){"use strict";var t=function(t){this.node={hook:{timeWrap:".tmdi",txt:".tmdi_txt",refresh:".tmdi_refresh",timeBtn:".tmdi_dimen",timeHour:".tmdi_cdhour",timeMin:".tmdi_cdmin"},$floor:null},this.conf={floorId:"",time:"1DAY",curCls:"tmdi_list_cur"},$.each(t,$.proxy(function(t,e){this.conf[t]=e},this)),this.init()};t.prototype={bindUI:function(){var t=this,e=t.node.hook,n=t.conf;$(e.timeWrap)[0]&&$(e.timeWrap).delegate(e.timeBtn,"click",function(t){var i=$(t.currentTarget).attr("data-time");$(e.timeWrap+" li").removeClass(n.curCls),$(t.currentTarget).closest("li").addClass(n.curCls),_.eventCenter.trigger("top_mod_dimension:click_"+n.floorId,i)}),$(e.timeWrap).delegate(e.refresh,"click",function(t){_.eventCenter.trigger("top_mod_dimension:refresh_"+n.floorId),_.eventCenter.trigger("showRefresh:"+n.floorId,0)}),_.eventCenter.on("showRefresh:"+n.floorId,function(t){t?($(e.txt).hide(),$(e.refresh).show()):($(e.txt).show(),$(e.refresh).hide())}),_.eventCenter.on("ticktock:"+n.floorId,function(e){t.changeTime(e)})},setDom:function(){var t=this,e=t.node,n=t.conf;$.each(e.hook,function(t,i){e.hook[t]="#"+n.floorId+" "+i}),e.$floor=$("#"+n.floorId)},setStyle:function(){var t=this,e=t.node,n=t.conf;$.each($(e.hook.timeBtn),function(t,e){var i=$(e),o=i.closest("li");i.attr("data-time")!=n.time||o.hasClass(n.curCls)?i.attr("data-time")!=n.time&&o.hasClass(n.curCls)&&o.removeClass(n.curCls):o.addClass(n.curCls)})},changeTime:function(t){var e=this.node.hook,n=(new Date).getTime(),i=parseInt((parseInt(t)-n)/6e4),o=this.getTime(i),r=$(e.txt),s=$(e.timeHour),a=$(e.timeMin);s.html(o[0]),a.html(o[1]),o[1]<=0&&o[0]<=0?r.hide():r.show()},getTime:function(t){var e,n;return"number"==typeof t?(e=parseInt(t/60),n=t-60*e):e=n=0,[e,n]},init:function(){var t=this;t.setDom(),t.setStyle(),t.bindUI()}},_.eventCenter.on("top_mod_dimension:initDimen",function(e,n){new t({floorId:e,time:n})})});define("widget/top_mod_more",["getTopParam"],function(require,exports,module){"use strict";var o=require("getTopParam"),t=o.getUrl,n=function(o){this.conf={floorId:"",hook:".J_more",params:{}},$.each(o,$.proxy(function(o,t){this.conf[o]=t},this)),this.init()};n.prototype={bindUI:function(){var o=this,n=o.conf;_.eventCenter.on("top_mod_more:link_"+n.floorId,function(o){var r=t(o),e=$("#"+n.floorId+" "+n.hook);e.attr("href",r)})},init:function(){var o=this.conf;this.bindUI(),_.eventCenter.trigger("top_mod_more:link_"+o.floorId,o.params)}},_.eventCenter.on("top_mod_more:init",function(o,t){new n({floorId:o,params:t})})});define("index3.0/widget/top_mod_floortitle",function(require,exports,module){"use strict"});define("index3.0/widget/top_mod_flag",function(require,exports,module){"use strict"});define("index3.0/widget/top_mod_full",function(require,exports,module){"use strict"});define("index3.0/widget/saleitem",function(require,exports,module){"use strict"});define("closeTip",function(){var i=function(i){var n=$(i),c=n.find(".J_tips_close");c.bind("click",function(){n.hide()})};return i});define("widget/top_sale",["uri","handleData","getFree","getStock","widget/top_mod_tags","countDown","closeTip","widget/top_mod_loadmore","triggerLazyLoad","updateTime"],function(require,exports,module){"use strict";var e=require("uri"),t=require("handleData"),o=require("getFree"),a=require("getStock"),i=require("widget/top_mod_loadmore"),n=require("triggerLazyLoad"),r=require("widget/top_mod_tags"),d=require("countDown"),s=require("closeTip"),l=new e(location.href).data.queryKey,m=require("updateTime"),u=function(){this.freeParams=[],this.ctime="",this.bindDone()};return u.prototype={init:function(e){if(!e.products.length)return _.eventCenter.trigger("data_empty","top_sale",e.resCid),!1;_.eventCenter.on("top_sale:done",function(){var e=$(".saleitem_cur");if(!(e.length=0)){var t=$(window).height(),o=e.offset()?e.offset().top:-1,a=e[0]?e.height():0,i=o-(t-a)/2,n=0;o<0||a<=0||$("html, body").animate({scrollTop:i+"px"},{duration:500,complete:function(){n||(setTimeout(function(){$(window).bind("mousemove.curhover",function(){$(".saleitem_cur").removeClass("saleitem_cur"),$(window).unbind("mousemove.curhover")})},1e3),n=1)}})}});var o=this,a=e.products,i=a.length,n=i>18?18:i;this.freeParams=[];for(var r=0;r<n;r++){var d=a[r];d.imgPath=t.setImgUrl(d.wareId,d.imgPath,160),!d.jdSale&&d.wareId&&d.venderId&&o.freeParams.push([1*d.wareId,1*d.venderId])}return window.data.top_sale.saleList=a,window.data.top_sale.cateInfo={sCid:e.resCid,qCid:e.reqCid,sCname:e.resCname,qCname:e.reqCname},window.data.top_sale.queryKey=l,this.ctime=e.ctime,!0},bindDone:function(){var e=this,t=8;_.eventCenter.on("top_sale:done",function(){var l=$(".J_saleList").find("li[data-mark]=free"),_=$(".J_saleList").find(".top_mod_tag_list"),u=$(".saleitem"),p=u.length;o(e.freeParams,l,_);var c=$(".J_saleList").find(".saleitem");a(c,function(e,t){e>0&&c.filter("[data-sku="+t+"]").find(".saleitem_info_spec").html("仅剩"+e+"件")});new r;s(".top_sale_tips");var f=$(".top_sale");if(d(f,m.sale,e.ctime),p<=t)return void n(u);new i({$dom:u,initNum:t,loadBtn:".top_sale .top_mod_loadmore_btn",loadWrap:".top_sale .top_mod_loadmore",needUndo:!0})})}},u});define("widget/preferred_list_item",["uri","handleData","getUriPrefix","api"],function(require,exports,module){"use strict";var e=require("uri"),i=require("api"),r=i.Pages,t=require("handleData"),a=require("getUriPrefix"),n="preferred_detail",d=1e3,s={handlePreferredData:function(e){return $.each(e,function(e,i){i.inventoryImg=t.setMobileImgUrl(i.id,i.inventoryImg,550,200),i.pageView=parseInt(i.pageView)+d,$.each(i.skus,function(e,r){i.skus[e].img=t.setMobileImgUrl(parseInt(i.id)+e,r.img,140),i.skus[e].url="//item.jd.com/"+i.skus[e].id+".html"})}),e},detailPrefix:function(){return a({uri:new e(window.location.href),page:r[n].normal,cms:r[n].cms,dev:r[n].dev,exclude:["cateId","cateName","id"]})}};return s});define("widget/top_preferred",["uri","api","setFloorData","getUriPrefix","widget/top_mod_loadmore","widget/preferred_list_item","triggerLazyLoad","setFloorColor"],function(require,exports,module){"use strict";var e=require("uri"),r=require("api"),t=r.Pages,o=require("widget/top_mod_loadmore"),i=(require("triggerLazyLoad"),require("setFloorData")),n=require("getUriPrefix"),d=require("widget/preferred_list_item"),a=require("setFloorColor"),l="preferred_list_item",p="top_preferred",f="preferred_detail",s=function(){this.bindDone()};return s.prototype={init:function(r){"-1"===r.code&&(r.content=[]);var o=r.content.length;a(0!==o);var l=o>=5?r.content.splice(0,5):r.content;return i(p,"preferredList",d.handlePreferredData(l)),i(p,"cateInfo",{sCid:r.resCid,sCname:r.resCname}),i(p,"detailPrefix",n({uri:new e(window.location.href),page:t[f].normal,cms:t[f].cms,dev:t[f].dev})),!0},bindDone:function(){var e=3;_.eventCenter.on(p+":done",function(){var r=$("."+l);new o({$dom:r,initNum:e,loadBtn:"."+p+" .top_mod_loadmore_btn",loadWrap:"."+p+" .top_mod_loadmore",needUndo:!0})})}},s});define("widget/shopitem",function(require,exports,module){});define("widget/top_shop",["handleData","getStock","widget/top_mod_tags","countDown","closeTip","widget/top_mod_loadmore","triggerLazyLoad","updateTime"],function(require,exports,module){"use strict";var o=require("handleData"),t=require("getStock"),e=require("widget/top_mod_tags"),i=require("countDown"),n=require("closeTip"),d=require("widget/top_mod_loadmore"),p=require("triggerLazyLoad"),a=require("updateTime"),r=function(){this.ctime="",this.bindDone()};return r.prototype={initNum:6,init:function(t){if(!t.shopList.length)return _.eventCenter.trigger("data_empty","top_shop",t.resCid),!1;for(var e=t.shopList,i=e.length,n=i>12?12:i,d=0;d<n;d++){var p=e[d];p.shopLogo&&""!=p.shopLogo&&(p.shopLogo=o.setMobileImgUrl(p.venderId,p.shopLogo,99,33));for(var a=0;a<2;a++){var r=p.products[a];r.imgPath=o.setImgUrl(r.wareId,r.imgPath,150)}}return window.data.top_shop.shopList=e,window.data.top_shop.cateInfo={sCid:t.resCid,qCid:t.reqCid,sCname:t.resCname,qCname:t.reqCname},this.ctime=t.ctime,!0},bindDone:function(){var o=this,r=this.initNum;_.eventCenter.on("top_shop:done",function(){var s=$(".shopitem"),h=s.length;new e;n(".top_shop_tips");var m=$(".J_shopList").find(".shopitem_good_item");t(m);var _=$(".top_shop");if(i(_,a.shop,o.ctime),h<=r)return void p(s);new d({$dom:s,initNum:r,loadBtn:".top_shop .top_mod_loadmore_btn",loadWrap:".top_shop .top_mod_loadmore",needUndo:!0})})}},r});define("widget/top_search",["api","setFloorData","load_async","handleData","backup","getStock","countDown","closeTip","widget/top_mod_loadmore","triggerLazyLoad","report","updateTime"],function(require,exports,module){"use strict";var t=require("api"),e=t.API,i=t.renderUrl,r=require("backup"),o=require("setFloorData"),a=require("load_async"),n=require("handleData"),s=require("getStock"),d=require("countDown"),c=require("closeTip"),h=require("widget/top_mod_loadmore"),u=require("triggerLazyLoad"),m=require("report"),p=require("updateTime"),l="top_hotsearch",g="searchlist",f=function(t){_.eventCenter.on("reportBackup_"+g+":backup",function(){m.processBackup(r.backupPointId["top_"+g])}),this.ctime="",this.bindDone(),t&&$.extend(this,t)};return f.prototype={initNum:4,maxNum:8,wordMax:5,done:0,counter:0,wordList:[],tempList:[],dataList:[],deferred:$.Deferred(),init:function(t){return this.dataList=[],this.done=0,this.counter=0,t.wordList&&t.wordList.length?(this.wordList=t.wordList,o(l,"needFullMask",this.wordList.length>this.maxNum),this.getData(this.getWordList()),o(l,"cateInfo",{sCid:t.resCid,qCid:t.reqCid,sCname:t.resCname,qCname:t.reqCname}),this.ctime=t.ctime,this.deferred):(_.eventCenter.trigger("data_empty",l,t.resCid),!1)},bindDone:function(){var t=this,e=this.initNum;_.eventCenter.on(l+":done",function(){var i=$(".top_search_item"),r=i.length;c(".top_search_tips");var o=$(".J_searchList").find(".top_search_good_item");s(o);var a=$("."+l);if(d(a,p.hotsearch,t.ctime),r<=e)return void u(i);new h({$dom:i,initNum:e,loadBtn:"."+l+" .top_mod_loadmore_btn",loadWrap:"."+l+" .top_mod_loadmore",needUndo:!0})})},getData:function(t){var o='["',n=t.length;$.each(t,function(t,e){o+=encodeURIComponent(e.keyString)+'"',o+=t+1<n?', "':"]"});var s=i(e[g].normal,{words:o});a({url:r.a1+s,backup:r.a2+s,times:2,timeout:1e3,jsonpCallback:"reportBackup_"+g}).done($.proxy(this.handleData,this))},handleData:function(t){if(!t.search_list&&!t.wordList)return!1;var e=this;if(t.search_list){var i=t.search_list;return $.each(i,function(t,i){var r=i.data;if(i.searchCount=e.tempList[i.word],r&&r.length>0&&!e.done&&($.each(r,function(t,e){e.imgPath=n.setImgUrl(e.wareId,e.imgPath,130)}),e.dataList.push(i),e.counter+=1,e.counter>=e.maxNum))return!1}),this.counter>=this.maxNum?(this.done=1,o(l,"searchList",this.dataList),void e.deferred.resolve(!0)):void this.getData(this.getWordList())}if(t.wordList){var r=t.wordList;r.length;$.each(r,function(t,e){$.each(e.products,function(t,e){return t<5&&(e.imgPath=n.setImgUrl(e.wareId,e.imgPath,130),!0)})}),o(l,"searchList",r),e.deferred.resolve(!0)}},getWordList:function(){if(!this.wordList.length)return this.deferred.reject(!1),[];var t=this,e=this.wordList.splice(0,this.wordMax);return $.each(e,function(e,i){t.tempList[i.keyString]=i.keyCount}),e}},f});define("index3.0/widget/discountitem",function(require,exports,module){"use strict"});define("widget/top_discount",["handleData","getFree","getStock","widget/top_mod_tags","countDown","closeTip","updateTime"],function(require,exports,module){"use strict";var t=require("handleData"),e=require("getFree"),i=require("getStock"),n=require("widget/top_mod_tags"),d=require("countDown"),o=require("closeTip"),a=require("updateTime"),s=function(){this.freeParams=[],this.ctime="",this.bindDone()};return s.prototype={init:function(e){if(!e.skuList.length)return _.eventCenter.trigger("data_empty","top_discount",e.resCid),!1;var i=this,n=e.skuList,d=n.length;this.freeParams=[];for(var o=0;o<d;o++){var a=n[o];a.imgPath=t.setImgUrl(a.wareId,a.imgPath,160),!a.jdSale&&a.wareId&&a.venderId&&i.freeParams.push([1*a.wareId,1*a.venderId])}return window.data.top_discount.discountList=n,window.data.top_discount.cateInfo={sCid:e.resCid,qCid:e.reqCid,sCname:e.resCname,qCname:e.reqCname},this.ctime=e.ctime,!0},bindDone:function(){var t=this;_.eventCenter.on("top_discount:done",function(){var s=$(".J_discountList").find("li[data-mark]=free"),r=$(".J_discountList").find(".top_mod_tag_list");e(t.freeParams,s,r);var u=$(".J_discountList").find(".discountitem");i(u,function(t,e){t>0&&u.filter("[data-sku="+e+"]").find(".discountitem_info_num").html("仅剩"+t+"件！")}),o(".top_discount_tips");var c=(new n,$(".top_discount"));d(c,a.discount,t.ctime)})}},s});define("widget/top_mod_cate_all",["load_async","api","backup","o2tpl","bindEvent","event"],function(require,exports,module){"use strict";var t=(require("o2tpl"),require("event"),function(t){this._initCls="tmc_initiating",$.extend(this,t)});return t.prototype={init:function(){this.$allCate=$("#"+this.floorId),this.$inject=$("."+this.injectCls)},renderCate:function(t){var i=this.processData(t);window.data[this.floorId]=window.data[this.floorId]||{},window.data[this.floorId].allCateList=i,this.setAllCate(i)},setAllCate:function(t){this._allCate=t},getAllCate:function(){return this._allCate},processData:function(t){var i=t.cateList,e={},a=[];return $.each(i,function(t,i){e[i.fid]=e[i.fid]||{},e[i.fid].catename||(e[i.fid].catename=i.fname),e[i.fid].subCates?e[i.fid].subCates.push(i):e[i.fid].subCates=[i]}),$.each(e,function(t,i){a.push({cateId:t,cateName:i.catename,subCates:i.subCates})}),a},injectDom:function(){this.$inject.append(this.$allCate[0]),this.$inject.find(".tmc_initiating").removeClass("tmc_initiating")}},t});define("widget/top_mod_locate",["backup","store","topStore"],function(require,exports,module){"use strict";var e=require("store"),t=require("topStore"),a=$("#J_local"),o=e.get("top-areaName"),c=require("backup").backupPointId;$.ajax({url:"//ch.jd.com/locate",type:"GET",dataType:"jsonp",jsonpCallback:"callback",scriptCharset:"UTF-8",timeout:3e3,success:function(c){a.html(c.a1),window.data.locate=c.a1,o&&o==c.a1||(t.removeAllStore(),e.set("top-areaName",c.a1))},error:function(r){a.html("北京"),window.data.locate="北京",o&&o==r.a1||(t.removeAllStore(),e.set("top-areaName","北京")),seajs.use("report",function(e){e.processBackup(c.locate)})}})}),seajs.use("widget/top_mod_locate");window.tplVersion={index_top_mod_cate_tpl:"7d04c8c095d01e22",top_discount_tpl:"1fcc4984f2346ff1",top_landing_discount_tpl:"712840f252e78365",top_landing_footer_discount_tpl:"971cf34b4af17b23",top_landing_footer_preferred_tpl:"e52a96e96c1ed2cd",top_landing_footer_sale_tpl:"41628c39e952a23f",top_landing_footer_search_tpl:"399e75f561ee5207",top_landing_footer_shop_tpl:"d9809dd20367154f",top_landing_preferred_detail_tpl:"86cafcdc24305cfc",top_landing_preferred_detail_footer_tpl:"fb5b92ac0da5b88e",top_landing_preferred_list_tpl:"b43f0c75983ca660",top_landing_sale_tpl:"076afbfe9f16d025",top_landing_search_tpl:"ac78716efaffa1ad",top_landing_shop_tpl:"6fadf324bc0d7924",top_mod_cate_all_tpl:"57bf3f215046c07a",top_preferred_tpl:"59a4683263957d33",top_sale_tpl:"473f1028304a095a",top_search_tpl:"6b4f5d5e1f10e3ec",top_shop_tpl:"5441c144e7097b2e"};var firstRender=1;define("init",["uri","backup","bindEvent","api","load_async","event","setFloorData","setError","getUriPrefix","widget/top_mod_cate","widget/top_sale","widget/top_preferred","widget/top_shop","widget/top_search","widget/top_discount","widget/top_mod_cate_all","store","topStore","report","setFloorColor"],function(require,exports,module){"use strict";var t=require("uri"),e=require("backup"),a=require("load_async"),o=require("event"),r=require("widget/top_mod_cate"),n=require("bindEvent"),c=require("api"),i=c.API,s=c.Pages,d=c.renderUrl,l=require("getUriPrefix"),p=require("setFloorData"),f=require("setFloorColor"),u=require("setError"),h=require("widget/top_sale"),m=require("widget/top_preferred"),g=require("widget/top_shop"),I=require("widget/top_search"),v=require("widget/top_discount"),C=require("widget/top_mod_cate_all"),k=(require("store"),require("topStore")),w=require("report");w.init(e.backupPointId.pageId,e.backupPointId.backupPageId);var b=function(e){this._urls=e,this._flags={},this._uri=new t(window.location.href),this._curCate={id:"",name:"",type:""},this._hasDataCate={},this._wrongList={},this._isBackup=!1,this.cateGot=new o(this),this.dataGot=new o(this),this.dataError=new o(this),this._params=this.getUriParam()};b.prototype={setEvent:function(t){var e=this;$.each(t,function(t,a){e[a+"_done"]=new o(e),e._hasDataCate[a]="",e._wrongList[a]={length:0}})},checkStore:function(t,e,a,o){var o=o||this._curCate.id,r=k.checkStore(o,e,!0);r?this.dataDone(e,a,r):this.getData({url:t,floorId:e,callback:a,store:!0,isBackup:!1,cateId:o})},getData:function(t){var o=this,r=t.url,n=t.floorId,c=t.callback,i=t.store,s=t.cateId,d=(t.fail,t.isBackup);a({url:d?e.a2+r:e.a1+r,backup:d?e.a1+r:e.a2+r,timeout:1e3,times:2,__trigger:!0,jsonpCallback:"reportBackup_"+n}).done(function(e){return"undefined"==typeof e.code&&"top_sale"===n&&f(!1),!d&&e.code&&"0"!==e.code?"top_preferred"===n?(o.dataDone(n,c,e,!1),!1):(s&&o.getStore(s,n,c),t.isBackup||(t.isBackup=1,o._isBackup=!0,!s&&o.getData(t)),!1):void o.dataDone(n,c,e,i)}).fail(function(e){"top_preferred"===n&&(f(!1),_.eventCenter.trigger("reportBackup_"+n+":backup")),d?(t.failCallback&&t.failCallback(),o.dataError.notify({floorId:n})):(t.isBackup=1,!s&&o.getData(t)),o._isBackup=!0})},dataDone:function(t,e,a,o){o&&this.setStore(this._curCate.id,t,a);var r=this,n=e?e(a):0;$.when(n).then(function(){n?($(window).trigger("scroll.lazydata"),r.setUriPrefix(t),r.dataTmplTest(t,"data")):o&&r.removeStore(r._curCate.id,t)},function(){o&&r.removeStore(r._curCate.id,t)})},setStore:function(t,e,a){t&&k.setStore(t,e,a)},removeStore:function(t,e){k.removeStore(t,e)},getStore:function(t,e,a){this.setWrongCate(e,t);var o=k.getStore(t,e);return o?void this.dataDone(e,a,o):void this.getAnotherStore(e,a)},setWrongCate:function(t,e){this._wrongList[t]&&(this._wrongList[t][e]=1,this._wrongList[t].length+=1)},getAnotherStore:function(t,e){var a=this._wrongList[t],o=this._hasDataCate[t],r=this._urls[t].uri,n="",c=this;return!o&&a.length<10&&$.each(B.getDataList().cateList,function(t,e){if(!a[e.cateId]&&!a[e])return o=e.cateId,!1}),o?(n=d(r,{cateId:o}),void this.checkStore(n,t,function(t,a){return function(a){return c._hasDataCate[t]=c._hasDataCate[t]||(c._isBackup?"":a.resCid),e&&e(a)}}(t,o),o)):void this.getData({url:d(r,{cateId:this._curCate.id}),floorId:t,callback:e,cateId:this._curCate.id,store:!1,isBackup:!0})},setUriPrefix:function(t){p(t,"urlPrefix",this.getUriPrefix({page:this._urls[t].page,cms:this._urls[t].cmsPage,dev:this._urls[t].dev}))},dataTmplTest:function(t,e){var a="data"==e?"tmpl":"data";this._flags[t]&&this._flags[t][a]?(this[t+"_done"].notify(),this._flags[t]={}):this.setFlag(t,e,1)},setFlag:function(t,e,a){this._flags[t]=this._flags[t]||{},this._flags[t][e]=a},setCurCate:function(t){this._curCate.id=t.cateInfo.cateId,this._curCate.name=t.cateInfo.cateName,this._curCate.type=t.cateInfo.type,this.dataGot.notify(t)},getUrl:function(t){return this._urls[t].uri},getDefensor:function(t){return this._urls[t].defensor},getUriParam:function(){var t=this._uri.data.queryKey;return{cateId:t.cateId||t.cateid,catePrime:parseInt(t.catePrime)}},getUriPrefix:function(t){var e=t.page,a=t.cms,o=t.dev;return l({uri:this._uri,page:e,cms:a,dev:o})}};var P=function(t,e){this._model=t,this._elements=e,this.cateClicked=new o(this);var a=this,r=this._elements;this._model.setEvent([r.cateId,r.cateAllId].concat(r.floorId)),_.eventCenter.on("top_floor_update",function(t){a.cateClicked.notify(t)}),_.eventCenter.on(r.cateId+":beforerender",function(t){a._model.cateGot.attach(t),a._model.dataTmplTest(r.cateId,"tmpl")}),_.eventCenter.on(r.cateId+":done",function(){S.initElements(),S.bindUI(),B.cateInit.notify(a._model.getUriParam())[0],$("#"+r.cateId).unbind("done"),a._model.getData({url:a._model.getUrl(r.cateAllId),defensor:"",floorId:r.cateAllId,callback:function(t){return r.instance[r.cateAllId].renderCate(t),B.setCateAllList(r.instance[r.cateAllId].getAllCate()),r.instance[r.cateAllId].init(),!0}})}),_.eventCenter.on("reportBackup_"+r.cateId+":backup",function(){w.processBackup(a._model._urls[r.cateId].report)}),_.eventCenter.on("reportBackup_"+r.cateAllId+":backup",function(){w.processBackup(a._model._urls[r.cateAllId].report)}),_.eventCenter.on(r.cateAllId+":beforerender",function(t){a._model[r.cateAllId+"_done"].attach(t),a._model.dataTmplTest(r.cateAllId,"tmpl")}),_.eventCenter.on(r.cateAllId+":done",function(){r.instance[r.cateAllId].injectDom(),S.initAllElements(a._model.getUriParam())}),$.each(r.floorId,function(t,e){_.eventCenter.on(e+":beforerender",function(t){return function(e){$("#"+t).unbind("beforerender"),a._model[t+"_done"].attach(e),a._model.dataTmplTest(t,"tmpl")}}(e)),_.eventCenter.on(e+":done",function(t){return u.remove(t),function(){$("#"+t).unbind("done"),_.eventCenter.trigger("cateMaskHide")}}(e)),_.eventCenter.on("reportBackup_"+e+":backup",function(t){return function(){w.processBackup(a._model._urls[t].report)}}(e))}),this._model.dataGot.attach(function(t,e){r.$title.html("[&nbsp;"+e.cateInfo.cateName+"&nbsp;]"),a.renderFloors(e.cateInfo.cateId),$(window).scrollTop(0)}),this._model[r.cateId+"_done"].attach(function(){a._model.cateGot.notify()}),this._model.dataError.attach(function(t,e){a.setError(e)})};P.prototype={show:function(){var t=this,e=this._elements,a=this._model.getUriParam(),o={url:this._model.getUrl(e.cateId),floorId:e.cateId},r={},n={};$.extend(r,o),$.extend(n,o),n.callback=function(a){return a.cateList.length>0?(B.setCateList(a),!0):($.each(e.floorId,function(e,a){t._model.dataError.notify({floorId:a})}),!1)},n.isBackup=!0,n.failCallback=function(){$.each(e.floorId,function(e,a){t._model.dataError.notify({floorId:a})})},r.callback=function(e){return e.cateList.length>0?(B.setCateList(e),!0):void t._model.getData(n)},a.cateId&&a.catePrime&&$("#"+e.cateId).css({display:"none"}),this._model.getData(r)},renderFloors:function(t){var e=this._elements,a=e.floorId;if(firstRender&&$.each(a,function(t,e){$("#"+e).hasClass("o2data-lazyload")||$("#"+e).hasClass("o2loading")||$("#"+e).addClass("o2data-lazyload")}),firstRender)return void(firstRender=0)},setError:function(t){var e=t.floorId,a=this._elements;e===a.cateId?$.each(a.floorId,function(t,e){u.sett(e)}):u.sett(e)}};var y=function(t,e){this._model=t,this._view=e,this._data=0,this._tmpl=0;var a=this;this._view.cateClicked.attach(function(t,e){a.cateChange(e)})};y.prototype={cateChange:function(t){var e=this._view._elements,a=this._model;this._model.setCurCate(t),n(e.floorId),$.each(e.floorId,function(o,r){a._flags[r]={},a.checkStore(d(a._urls[r].uri,t.cateInfo),r,function(t,o){return function(r){r.reqCid=o.cateInfo.cateId,r.reqCname=o.cateInfo.cateName;var n=e.instance[t].init(r);return $.when(n).then(function(){n&&(a._hasDataCate[t]=a._hasDataCate[t]||(a._isBackup||"all"===o.cateInfo.type?"":o.cateInfo.cateId))}),n}}(r,t))})}};var D=r({},{floorId:"top_mod_cate",items:".tmc_anchor",keyLists:".tmk_list",keys:".tmk_anchor",more:".tmc_more",allList:".tmca",allFstItems:".tmca_fstcls_anchor",allFstList:".tmca_fstcls",allScdItems:".tmca_scdcls_anchor",allScdList:".tmca_scdcls",allScdWrap:".tmca_scdclses",allTrdItems:".tmca_trdcls_anchor",fixedwrap:".tmc"},{cateMini:"tmc_mini",cateBiCur:"tmc_cur",keyBiCur:"tmk_item_cur",hoverMore:"tmc_unfold",moreCur:"tmc_more_on",fixed:"tmc_fixed",allMini:"tmca_mini",allFstCur:"tmca_fstcls_item_cur",allScdCur:"tmca_scdcls_item_cur",allTrdCur:"tmca_trdcls_item_cur",mask:"tmc_mask"}),B=D.M,S=D.V,A=(D.C,new b({top_mod_cate:{uri:i.cate.normal,defensor:i.cate.defensor,page:s.cate.normal,cmsPage:s.cate.cms,dev:s.cate.dev,report:e.backupPointId.top_mod_cate},top_sale:{uri:i.sale.normal,defensor:i.sale.defensor,page:s.sale.normal,cmsPage:s.sale.cms,dev:s.sale.dev,report:e.backupPointId.top_sale},top_preferred:{uri:i.preferred.normal,defensor:i.preferred.defensor,page:s.preferred.normal,cmsPage:s.preferred.cms,dev:s.preferred.dev,report:e.backupPointId.top_preferred},top_shop:{uri:i.shop.normal,defensor:i.shop.defensor,page:s.shop.normal,cmsPage:s.shop.cms,dev:s.shop.dev,report:e.backupPointId.top_shop},top_hotsearch:{uri:i.search.normal,defensor:i.search.defensor,page:s.search.normal,cmsPage:s.search.cms,dev:s.search.dev,report:e.backupPointId.top_hotsearch},top_discount:{uri:i.discount.normal,defensor:i.discount.defensor,page:s.discount.normal,cmsPage:s.discount.cms,dev:s.discount.dev,report:e.backupPointId.top_discount},top_mod_cate_all:{uri:i.cate_all.normal,defensor:i.cate_all.defensor,page:s.cate_all.normal,cmsPage:s.cate_all.cms,dev:s.cate_all.dev,report:e.backupPointId.top_mod_cate_all}})),L=new P(A,{cateId:"top_mod_cate",cateAllId:"top_mod_cate_all",floorId:["top_sale","top_preferred","top_shop","top_hotsearch","top_discount"],instance:{top_sale:new h,top_preferred:new m,top_shop:new g,top_hotsearch:new I,top_discount:new v,top_mod_cate_all:new C({floorId:"top_mod_cate_all",injectCls:"top_mod_cate_outer"})},$title:$(".top_mod_maintitle_txt")});new y(A,L);L.show(),n(["top_mod_cate","top_mod_cate_all"])}),seajs.use("init");